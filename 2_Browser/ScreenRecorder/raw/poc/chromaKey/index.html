<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
          background: black;
          color:#CCCCCC; 
        }
        #c2 {
          background-image: url(Capture.JPG);
          background-repeat: no-repeat;
          background-size: 100% 100%;
        }
        div {
          /* float: left; */
          border :1px solid #444444;
          padding:10px;
          margin: 10px;
          background:#3B3B3B;
        }
        video {
            height: 10rem;
            width: 20rem;
        }
      </style>
</head>
<body>
    <div>
        <video id="video" autoplay controls="true"/>
      </div>
      <div>
        <canvas id="c1"></canvas>
        <canvas id="c2"></canvas>
      </div>
    <script>
        let c1;  // For comparison of original stream
        let c2;  // For chroma manipulation to the video stream
        let tool1;
        let tool2;
        let video = document.querySelector("video");
        
        let liveStream = navigator.mediaDevices.getUserMedia({  // Gets user camera stream
            video: true,
            audio: true
        });

        liveStream
            .then(function(stream) {
                video.srcObject = stream;
                c1 = document.querySelector("#c1");
                c2 = document.querySelector("#c2");
                tool1 = c1.getContext("2d");
                tool2 = c2.getContext("2d");
                video.addEventListener("play", function() {  // On video play -> Initiate Chroma manipulation
                    videoMainpulationTimer();
                })
            })

        function videoMainpulationTimer() {  // Call timer for repeated chroma manipulation to the video stream
            if (video.paused || video.ended) {
                return;
            }

            computeFrame();
            setTimeout(function() {
                videoMainpulationTimer();
            }, 0)
        }

        function computeFrame() {  // Manipulate video stream with conditions of chroma
            tool1.drawImage(video, 0, 0, c1.width, c1.height);
            let frame = tool1.getImageData(0, 0, c1.width, c1.height);
            let len = frame.data.length;
  
            for (let i = 0; i < len; i++) {
                let r = frame.data[i + 0];
                let g = frame.data[i + 1];
                let b = frame.data[i + 2];
                if (r >= 0 && g >= 100 && b >= 50)  // Chroma condition (for standard chroma condition (r > 0 && g > 177 && b > 64))
                    frame.data[i + 3] = 0;
            }
            tool2.putImageData(frame, 0, 0);
            return;
        }

        
    </script>
</body>
</html>